\begin{blstlisting}
  apply_recurse_node(label: int,
                     low, high: NodeArc$\times$NodeArc,
                     op: bool$\times$bool $\rightarrow$ bool):
        low' = case low of
               | (Sink{value$_1$}, Sink{value$_2$}) => Sink{op(value$_1$, value$_2$)}
               | _ => low

        high' = case high of
                | (Sink{value$_1$}, Sink{value$_2$}) => Sink{op(value$_1$, value$_2$)}
                | _ => low

         v' := { index: iO--, label: label, low: low', high: high' }
         if !is_sink(low'): $\ApplyQrec$.insert((v,low',False,None))
         if !is_sink(high'): $\ApplyQrec$.insert((v,high',True,None))

         return v'
\end{blstlisting}
